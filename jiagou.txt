目标与原则
同时查询轨道A与轨道B。
以轨道A（公司基础信息/公告/研发等）作为“事实上下文”直接生成初稿。
用轨道B（标准回答库）做“对齐与校验”：确认逻辑与框架、强制规范表述、必要时覆盖或补齐关键表述。
双轨并查与决策流程（高层）
1) 预处理
问题规范化（去噪、实体提取、披露期判定）。
路由意图（公司基本信息/公告解读/研发进展/财务指标/合规声明…）。
2) 并行检索
A轨检索（知识库A）：RAGFlow 在“公告、研报、FAQ、政策法规、对外披露材料”等分类同时召回，top-kA。
B轨检索（标准回答库B）：RAGFlow 标准回答向量库召回，top-kB。
两路并行，互不阻塞；返回时包含chunk、来源、时间戳、版本等元数据。
3) 初稿生成（以A为主）
使用A轨召回上下文 + Prompt 模板生成“事实型初稿”。
初稿中明确引用来源片段与日期（可在前端高亮）。
4) 标准对齐与校验（以B为约束）
语义匹配：将用户问题与B轨召回的标准问匹配，得到匹配分与置信度。
框架对齐：若存在高置信的“标准模板/表述”，按模板重排初稿结构（标题、免责声明、口径）。
冲突检测：对比初稿与B的核心结论/口径，若矛盾则标记“需人工审核”或直接以B为准覆盖易出错表述。
补齐关键要素：若标准回答要求固定的披露措辞/限制语，则在初稿末尾强制补齐。
5) 合规拦截（前后双层）
生成前：敏感/未披露关键词与规则库预拦截（拒答或降级回答）。
生成后：事实来源校验（初稿引用必须可回溯A的披露材料）；口径一致性校验（对齐B的标准术语/模板）。
6) 审核与产出
将“初稿 + 标准对齐建议 + 冲突标记 + 来源证据”推入审核队列。
审核通过后产出对外答复。优秀回答可一键“升级为标准回答”（写入B轨并版本化）。
决策规则（示例，可调参）
B轨“强约束阈值”θ_strong：相似度≥θ_strong时，框架与关键措辞按B轨标准执行（优先保证口径一致）。
B轨“弱约束阈值”θ_weak：θ_weak≤相似度<θ_strong时，保留A轨事实初稿，套用B轨模板中的结构/免责声明，但不强制覆盖事实结论。
若B无满足θ_weak，直接输出A轨初稿，但要求显式引用A来源并附合规免责声明。
任一冲突/未披露风险命中则进入“必须人工审核”。
更新后的架构图（ASCII）
[Investor UI - Vue + Element Plus]
  - 提问/批量问题导入（Excel/CSV）
  - Prompt 可视化编辑与版本选择
  - 审核工作台（对齐建议/冲突标记/来源高亮）
  - 标注优秀 -> 写入标准回答库B（版本化）

            | 提问
            v
[FastAPI Backend]
  - 路由与权限(RBAC: IR/审核员/管理员)
  - Prompt 模板与版本管理
  - 并行检索编排(Async): A & B
  - 初稿生成(以A为主) + 标准对齐(以B为约束)
  - 合规双层拦截(前/后)
  - 审核队列/操作留痕(留存3个月)
  - 批量导入（Excel/CSV -> A/B）
            |                                   \
            | MySQL 8.4 LTS                       \ RAGFlow v0.21.0
            | 元数据/任务/版本/审核/日志             \ 知识库A 与 标准回答库B
            v                                      v
[MySQL: users/roles, prompts, standard_answers(ver), questions, reviews, ops_logs, imports]
[Local Storage: 原始文档/解析中间产物/导入批次工单]

检索生成路径（一次问答）：
User Q
  -> Backend 并发调用 RAGFlow: {A检索 top-kA, B检索 top-kB}
  -> 以A上下文 + Prompt 生成初稿
  -> 用B进行语义匹配/框架对齐/冲突检测/口径校验
  -> 合规二次拦截
  -> 审核队列 -> 审核通过 -> 输出
  -> 若标注优秀 -> 写入B(版本化/生效窗口)
  [Investor UI - Vue + Element Plus]
  - 提问/批量问题导入（Excel/CSV）
  - Prompt 可视化编辑与版本选择
  - 审核工作台（对齐建议/冲突标记/来源高亮）
  - 标注优秀 -> 写入标准回答库B（版本化）

            | 提问
            v
[FastAPI Backend]
  - 路由与权限(RBAC: IR/审核员/管理员)
  - Prompt 模板与版本管理
  - 并行检索编排(Async): A & B
  - 初稿生成(以A为主) + 标准对齐(以B为约束)
  - 合规双层拦截(前/后)
  - 审核队列/操作留痕(留存3个月)
  - 批量导入（Excel/CSV -> A/B）
            |                                   \
            | MySQL 8.4 LTS                       \ RAGFlow v0.21.0
            | 元数据/任务/版本/审核/日志             \ 知识库A 与 标准回答库B
            v                                      v
[MySQL: users/roles, prompts, standard_answers(ver), questions, reviews, ops_logs, imports]
[Local Storage: 原始文档/解析中间产物/导入批次工单]

检索生成路径（一次问答）：
User Q
  -> Backend 并发调用 RAGFlow: {A检索 top-kA, B检索 top-kB}
  -> 以A上下文 + Prompt 生成初稿
  -> 用B进行语义匹配/框架对齐/冲突检测/口径校验
  -> 合规二次拦截
  -> 审核队列 -> 审核通过 -> 输出
  -> 若标注优秀 -> 写入B(版本化/生效窗口)